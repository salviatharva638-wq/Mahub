<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Explore Recipes - Maha Recipe Hub</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
/* üåü Base Layout */
body { 
  font-family:'Inter',sans-serif; 
  margin:0; 
  background:#fffaf5; 
  color:#333; 
  display:flex; 
  flex-direction:column; 
  min-height:100vh; 
}

/* üåü Header & Navigation */
header { 
  display:flex; 
  justify-content:space-between; 
  align-items:center; 
  padding:10px 30px; 
  background:#fff; 
  border-bottom:1px solid #eee; 
  position:sticky; 
  top:0; 
  z-index:100; 
}
header img { height:50px; cursor:pointer; transition:0.3s; }
header img:hover { transform:scale(1.05); }

nav a { 
  text-decoration:none; 
  margin-left:15px; 
  color:#333; 
  font-weight:600; 
  padding:6px 14px; 
  border-radius:6px; 
  transition:.3s; 
}
nav a:hover { background:#ff7f50; color:#fff; }
nav .login-btn { background:#ff7f50; color:white; }
nav #logout-link { background:#ff4c4c; color:white; }

/* üåü Profile Button & Menu */
nav #profile-link { 
  background:#ff7f50; 
  color:white; 
  border-radius:50px; 
  padding:6px 12px; 
  display:flex; 
  align-items:center; 
  gap:5px; 
  cursor:pointer; 
}
nav #profile-link img {
  width:28px; height:28px; border-radius:50%; object-fit:cover;
}
nav #profile-menu { 
  display:none; 
  position:absolute; 
  top:70px; 
  right:30px; 
  background:white; 
  border:1px solid #ddd; 
  border-radius:10px; 
  box-shadow:0 4px 12px rgba(0,0,0,0.1); 
  width:180px; 
}
nav #profile-menu a { 
  display:block; 
  padding:10px 15px; 
  text-decoration:none; 
  color:#333; 
  transition:0.3s;
}
nav #profile-menu a:hover { background:#ff7f50; color:white; }

/* üåü Section Title */
.page-strip { 
  background:linear-gradient(90deg,#ff7f50,#ffb07f); 
  color:white; 
  text-align:center; 
  font-size:2rem; 
  font-weight:700; 
  padding:20px 0; 
}

/* üåü Search & Filter UI */
.search-container { 
  display:flex; 
  justify-content:center; 
  margin:20px 0; 
  gap:10px; 
  flex-wrap:wrap; 
}
.search-container input { 
  padding:10px 15px; 
  width:250px; 
  border-radius:8px; 
  border:1px solid #ddd; 
}
.search-container select { 
  padding:10px 12px; 
  border-radius:8px; 
  border:1px solid #ddd; 
}

.filter-tags { 
  display:flex; 
  justify-content:center; 
  gap:10px; 
  flex-wrap:wrap; 
  margin-bottom:20px; 
}
.filter-tags button { 
  padding:6px 12px; 
  border:none; 
  border-radius:8px; 
  cursor:pointer; 
  background:#ffb07f; 
  color:white; 
  transition:.3s; 
}
.filter-tags button.active, 
.filter-tags button:hover { background:#ff7f50; }

/* üåü Recipe Cards */
.recipe-container { 
  display:flex; 
  flex-wrap:wrap; 
  justify-content:center; 
  gap:25px; 
  margin:auto; 
  max-width:1200px; 
  padding-bottom:50px; 
}

.recipe-card { 
  background:white; 
  border-radius:15px; 
  overflow:hidden; 
  width:250px; 
  cursor:pointer; 
  box-shadow:0 3px 8px rgba(0,0,0,0.1); 
  transition:.3s; 
  text-align:center; 
  position:relative; 
}
.recipe-card:hover { transform:translateY(-8px) scale(1.02); }
.recipe-card img { width:100%; height:160px; object-fit:cover; }
.recipe-card h3 { color:#ff7f50; margin:12px 0 6px; }
.recipe-card p { padding:0 12px 12px; color:#555; }

/* üåü Rank Badge */
.rank-badge {
  position:absolute;
  top:10px;
  left:10px;
  background:#ff7f50;
  color:white;
  padding:4px 8px;
  border-radius:6px;
  font-weight:bold;
  font-size:0.8rem;
}

/* üåü Tags inside cards */
.recipe-tags {
  display:flex;
  justify-content:center;
  gap:6px;
  margin-bottom:8px;
  flex-wrap:wrap;
}
.recipe-tags span {
  background:#ffe3d2;
  padding:3px 8px;
  border-radius:12px;
  font-size:0.8rem;
  color:#ff7f50;
  font-weight:600;
}

/* üåü Like / Favorite Buttons */
.card-actions {
  display:flex;
  justify-content:space-between;
  padding:8px 12px;
  align-items:center;
}
.fav-btn, .like-btn {
  border:none;
  background:none;
  cursor:pointer;
  font-size:1.1rem;
  transition:0.3s;
}
.fav-btn.active i { 
  color:#ff4c4c; 
  transform:scale(1.2); 
  transition:transform 0.2s ease; 
}
.like-btn i { color:#777; margin-right:5px; }
.like-btn:hover i, 
.fav-btn:hover i { transform:scale(1.3); }

.like-btn.animate { transform:scale(1.4); }

/* üåü Footer */
footer { 
  background:#333; 
  color:white; 
  padding:25px; 
  text-align:center; 
  margin-top:auto; 
}
</style>
</head>
<body>

<header>
  <!-- üåü Logo -->
  <img src="assets/logo.png" alt="Maha Recipe Hub" onclick="window.location.href='index.html'">

  <!-- üåü Navigation -->
  <nav>
    <a href="index.html">Home</a>
    <a href="explore.html">Explore</a>
    <a href="recipe-generator.html">Find My Recipe</a>
    <a href="about.html">About</a>
    <a href="login.html" class="login-btn" id="login-link">Login</a>
    <a href="#" id="logout-link" style="display:none;">Logout</a>

    <!-- üåü Profile Icon -->
    <div id="profile-link" style="display:none;">
      <img id="profile-avatar" src="assets/default-avatar.png" alt="User Avatar">
      <span id="profile-name">You</span>
    </div>

    <!-- üåü Profile Dropdown Menu -->
    <div id="profile-menu">
      <a href="profile.html">üë§ Profile</a>
      <a href="my-recipes.html">üìñ My Recipes</a>
      <a href="favorites.html">‚ù§Ô∏è Favorites</a>
      <a href="#" id="logout-menu-link">üö™ Logout</a>
    </div>
  </nav>
</header>

<div class="page-strip">Explore Recipes</div>

<div class="search-container">
  <input type="text" id="searchInput" placeholder="Search by recipe name or ingredient">
  <select id="sortSelect">
    <option value="time">Recently Added</option>
    <option value="popular">Most Popular</option>
    <option value="a-z">A-Z</option>
  </select>
</div>

<div class="filter-tags">
  <button data-type="all" class="active">All</button>
  <button data-type="vegetarian">Vegetarian</button>
  <button data-type="sweet">Sweet</button>
  <button data-type="spicy">Spicy</button>
  <button data-type="festive">Festive</button>
  <button data-type="gluten-free">Gluten-Free</button>
</div>

<main>
  <div id="status" style="text-align:center;margin-top:25px;">Loading recipes...</div>
  <div class="recipe-container" id="recipe-list"></div>
</main>

<footer>&copy; 2025 Maha Recipe Hub</footer>

<script>
const SUPABASE_URL = "https://sraahdptzfbkrxrbllqx.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNyYWFoZHB0emZia3J4cmJsbHF4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1NDczMjMsImV4cCI6MjA3NDEyMzMyM30.lJ6E8E70Mag1F7VC9jT7JLZqhcOX7oJBX20BhBWjZy0";
const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const recipeList = document.getElementById("recipe-list");
const searchInput = document.getElementById("searchInput");
const filterButtons = document.querySelectorAll(".filter-tags button");
const sortSelect = document.getElementById("sortSelect");
let recipes = [];
let favorites = [];
let currentFilter = "all";

// ‚úÖ Load recipes
async function loadRecipes() {
  const { data, error } = await client.from("recipes").select("*");
  const status = document.getElementById("status");
  if (error) {
    console.error(error);
    status.textContent = "Failed to load recipes.";
    return;
  }
  status.style.display = "none";
  recipes = data;
  await loadFavorites();
  renderRecipes(recipes);
}

// ‚úÖ Load favorites for current user
async function loadFavorites() {
  const user = localStorage.getItem("username");
  if (!user) return;
  const { data } = await client.from("favorites").select("recipe_id").eq("user_id", user);
  favorites = data ? data.map(f => f.recipe_id) : [];
}

// ‚úÖ Render recipe cards
function renderRecipes(list) {
  recipeList.innerHTML = "";
  if (list.length === 0) {
    recipeList.innerHTML = "<p style='text-align:center;width:100%'>No recipes found!</p>";
    return;
  }

  // Rank recipes for current filter
  list.forEach((r, i) => {
    const rank = i + 1;
    const tags = `<div class="recipe-tags">
      <span>${r.category || "General"}</span>
      <span>${r.type || "Food"}</span>
    </div>`;

    const isFav = favorites.includes(r.id);
    const card = document.createElement("div");
    card.className = "recipe-card";
    card.innerHTML = `
      <div class="rank-badge">#${rank}</div>
      <img src="${r.image_url}">
      <h3>${r.name}</h3>
      ${tags}
      <p>${r.description ? r.description.slice(0, 80) + "..." : ""}</p>
      <div class="card-actions">
        <button class="fav-btn ${isFav ? 'active' : ''}" data-id="${r.id}"><i class="fa${isFav ? 's' : 'r'} fa-heart"></i></button>
        <button class="like-btn" data-id="${r.id}"><i class="fa fa-thumbs-up"></i> ${r.likes || 0}</button>
      </div>
    `;
    recipeList.appendChild(card);
  });

  // Add button listeners
  document.querySelectorAll(".fav-btn").forEach(btn => btn.onclick = toggleFavorite);
  document.querySelectorAll(".like-btn").forEach(btn => btn.onclick = addLike);
}

// ‚úÖ Favorite toggle
async function toggleFavorite(e) {
  e.stopPropagation();
  const recipeId = parseInt(e.currentTarget.dataset.id);
  const user = localStorage.getItem("username");
  if (!user) return alert("Please login first!");

  const isFav = favorites.includes(recipeId);
  if (isFav) {
    await client.from("favorites").delete().eq("recipe_id", recipeId).eq("user_id", user);
    favorites = favorites.filter(f => f !== recipeId);
  } else {
    await client.from("favorites").insert([{ recipe_id: recipeId, user_id: user }]);
    favorites.push(recipeId);
  }
  renderRecipes(recipes);
}

// ‚úÖ Like system
async function addLike(e) {
  e.stopPropagation();
  const recipeId = parseInt(e.currentTarget.dataset.id);
  const recipe = recipes.find(r => r.id === recipeId);
  recipe.likes = (recipe.likes || 0) + 1;
  await client.from("recipes").update({ likes: recipe.likes }).eq("id", recipeId);
  renderRecipes(recipes);
}

// ‚úÖ Quick to Cook sorting
sortSelect.addEventListener("change", () => {
  if (sortSelect.value === "quick") {
    recipes.sort((a,b) => a.time - b.time);
  } else if (sortSelect.value === "popular") {
    recipes.sort((a,b) => (b.likes||0) - (a.likes||0));
  }
  renderRecipes(recipes);
});

// ‚úÖ Login system
const loginLink = document.getElementById("login-link");
const logoutLink = document.getElementById("logout-link");
const welcomeMsg = document.getElementById("welcome-msg");

function checkLogin() {
  const user = localStorage.getItem("username");
  if (user) {
    loginLink.style.display = "none";
    welcomeMsg.style.display = "inline";
    welcomeMsg.textContent = "Welcome, " + user;
    logoutLink.style.display = "inline";
  }
}
logoutLink.onclick = () => { localStorage.removeItem("username"); location.reload(); };
checkLogin();

loadRecipes();
</script>
<script>
  // üåü Profile dropdown toggle
  const profileLink = document.getElementById("profile-link");
  const profileMenu = document.getElementById("profile-menu");

  profileLink?.addEventListener("click", () => {
    profileMenu.style.display = 
      profileMenu.style.display === "block" ? "none" : "block";
  });

  // üåü Close menu when clicking outside
  document.addEventListener("click", (e) => {
    if (!profileLink.contains(e.target) && !profileMenu.contains(e.target)) {
      profileMenu.style.display = "none";
    }
  });

  // üåü Logout link connection
  document.getElementById("logout-menu-link")?.addEventListener("click", () => {
    // your logout logic here (example)
    console.log("User logged out");
  });
</script>
</body>
</html>

