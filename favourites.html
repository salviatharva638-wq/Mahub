<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Favorites - Maha Recipe Hub</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
body { font-family:'Inter',sans-serif;margin:0;background:#fffaf5;color:#333;display:flex;flex-direction:column;min-height:100vh; }
header { display:flex;justify-content:space-between;align-items:center;padding:10px 30px;background:#fff;border-bottom:1px solid #eee;position:sticky;top:0;z-index:100; }
header img { height:50px;cursor:pointer;transition:0.3s; }
header img:hover { transform:scale(1.05); }
nav a { text-decoration:none;margin-left:15px;color:#333;font-weight:600;padding:6px 14px;border-radius:6px;transition:.3s; }
nav a:hover { background:#ff7f50;color:#fff; }
nav .login-btn { background:#ff7f50;color:white; }
nav #logout-link { background:#ff4c4c;color:white; }
nav #profile-link { background:#ff7f50;color:white;border-radius:50px;padding:6px 12px;display:flex;align-items:center;gap:5px;cursor:pointer; }
nav #profile-menu { display:none;position:absolute;top:70px;right:30px;background:white;border:1px solid #ddd;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.1);width:180px; }
nav #profile-menu a { display:block;padding:10px 15px;text-decoration:none;color:#333; }
nav #profile-menu a:hover { background:#ff7f50;color:white; }

.page-strip { background:linear-gradient(90deg,#ff7f50,#ffb07f);color:white;text-align:center;font-size:2rem;font-weight:700;padding:20px 0; }

.search-container { display:flex;justify-content:center;margin:20px 0;gap:10px;flex-wrap:wrap; }
.search-container input { padding:10px 15px;width:250px;border-radius:8px;border:1px solid #ddd; }
.search-container select { padding:10px 12px;border-radius:8px;border:1px solid #ddd; }

.recipe-container { display:flex;flex-wrap:wrap;justify-content:center;gap:25px;margin:auto;max-width:1200px;padding-bottom:50px; }
.recipe-card { background:white;border-radius:15px;overflow:hidden;width:250px;cursor:pointer;box-shadow:0 3px 8px rgba(0,0,0,0.1);transition:.3s;text-align:center;position:relative; }
.recipe-card:hover { transform:translateY(-8px)scale(1.02); }
.recipe-card img { width:100%;height:160px;object-fit:cover; }
.recipe-card h3 { color:#ff7f50;margin:12px 0 6px; }
.recipe-card p { padding:0 12px 12px;color:#555; }
.recipe-tags { margin-bottom:8px; }
.recipe-tag { background:#ffe5d6;color:#d35400;padding:2px 6px;border-radius:5px;font-size:0.8rem;margin:2px;display:inline-block; }

.like-btn { transition:transform 0.2s; }
.like-btn.animate { transform:scale(1.4); }

footer { background:#333;color:white;padding:25px;text-align:center;margin-top:auto; }
</style>
</head>
<body>

<header>
  <img src="logo.png" onclick="window.location.href='index.html'">
  <nav>
    <a href="index.html">Home</a>
    <a href="explore.html">Explore</a>
    <a href="recipe-generator.html">Find My Recipe</a>
    <a href="about.html">About</a>
    <a href="login.html" id="login-link" class="login-btn">Login</a>
    <div id="profile-link" style="display:none;"><i class="fas fa-user"></i> <span id="profile-username"></span></div>
    <div id="profile-menu">
      <a href="favorites.html" style="background:#ff7f50;color:white;">Favorites</a>
      <a href="#" id="logout-link">Logout</a>
    </div>
  </nav>
</header>

<div class="page-strip">My Favorites ❤️</div>

<div class="search-container">
  <input type="text" id="searchInput" placeholder="Search in favorites">
  <select id="sortSelect">
    <option value="time">Recently Added</option>
    <option value="popular">Most Popular</option>
    <option value="a-z">A-Z</option>
  </select>
</div>

<main>
   <div id="status" style="text-align:center;margin-top:20px;">Loading your favourites...</div>
<div id="fav-list" class="recipe-list"></div>
</main>

<footer>&copy; 2025 Maha Recipe Hub</footer>

<script>
const SUPABASE_URL = "https://sraahdptzfbkrxrbllqx.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNyYWFoZHB0emZia3J4cmJsbHF4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1NDczMjMsImV4cCI6MjA3NDEyMzMyM30.lJ6E8E70Mag1F7VC9jT7JLZqhcOX7oJBX20BhBWjZy0";
const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const recipeList = document.getElementById("fav-list");
const status = document.getElementById("status");
const user = localStorage.getItem("username");

if (!user) {
  status.textContent = "Please login to view your favourites!";
} else {
  loadFavorites();
}

async function loadFavorites() {
  // 1️⃣ Get favourite recipe IDs for this user
  const { data: favs, error: favError } = await client
    .from("favorites")
    .select("recipe_id")
    .eq("user_id", user);

  if (favError) {
    console.error("Error fetching favourites:", favError);
    status.textContent = "Failed to load favourites.";
    return;
  }

  if (!favs || favs.length === 0) {
    status.textContent = "No favourites yet!";
    return;
  }

  const recipeIds = favs.map(f => f.recipe_id);

  // 2️⃣ Fetch the actual recipes
  const { data: recipes, error: recipeError } = await client
    .from("recipes")
    .select("*")
    .in("id", recipeIds);

  if (recipeError) {
    console.error("Error fetching recipes:", recipeError);
    status.textContent = "Failed to load recipes.";
    return;
  }

  status.style.display = "none";
  renderFavorites(recipes);
}

// 3️⃣ Render favourite recipes
function renderFavorites(list) {
  recipeList.innerHTML = "";
  list.forEach(r => {
    const card = document.createElement("div");
    card.className = "recipe-card";
    card.innerHTML = `
      <img src="${r.image_url}" alt="${r.name}">
      <h3>${r.name}</h3>
      <div class="recipe-tags">
        <span>${r.category || "General"}</span>
        <span>${r.type || "Food"}</span>
      </div>
      <p>${r.description ? r.description.slice(0, 80) + "..." : ""}</p>
      <div class="card-actions">
        <button class="like-btn"><i class="fa fa-thumbs-up"></i> ${r.likes || 0}</button>
      </div>
    `;
    recipeList.appendChild(card);
  });
}
</script>
</body>
</html>
