<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recipe Generator - Maha Recipe Hub</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
/* (Your existing CSS stays same) */
body { font-family:'Inter',sans-serif;margin:0;background:#fff;color:#333;display:flex;flex-direction:column;min-height:100vh; }
header { display:flex;justify-content:space-between;align-items:center;padding:10px 30px;background:#fff;border-bottom:1px solid #eee; }
nav a { padding:6px 14px;border-radius:6px;text-decoration:none;color:#333;font-weight:600; }
nav a:hover { background:#ff7f50;color:#fff; }
nav .login-btn { background:#ff7f50;color:white; }
.recipe-container { display:flex;flex-wrap:wrap;justify-content:center;gap:25px;margin-top:30px; }
.recipe-card { background:white;border-radius:15px;width:250px;overflow:hidden;cursor:pointer;box-shadow:0 3px 8px rgba(0,0,0,.1);transition:.3s; }
.recipe-card:hover { transform:translateY(-8px)scale(1.02); }
.recipe-card img { width:100%;height:160px;object-fit:cover; }
.recipe-card h3 { color:#ff7f50;margin:12px 0 6px;text-align:center; }
.recipe-card p { color:#555;text-align:center;padding:0 10px 12px; }
footer { background:#333;color:white;text-align:center;padding:25px;margin-top:auto; }
</style>
</head>
<body>

<header>
  <img src="logo.png" height="50" onclick="location.href='index.html'">
  <nav>
    <a href="index.html">Home</a>
    <a href="explore.html">Explore</a>
    <a href="recipe-generator.html" style="background:#ff7f50;color:white;">Find My Recipe</a>
    <a href="about.html">About</a>
    <a href="login.html" id="login-link" class="login-btn">Login</a>
    <span id="welcome-msg" style="display:none;"></span>
    <a href="#" id="logout-link" style="display:none;background:#ff4c4c;color:white;">Logout</a>
  </nav>
</header>

<div class="hero">
  <h1>Find Recipes Based on Ingredients</h1>
</div>

<main>
  <div style="text-align:center;margin-top:30px;">
    <input id="ingredientInput" placeholder="Enter ingredients (comma separated)" style="padding:12px;width:60%;max-width:400px;">
    <button id="searchBtn" style="padding:12px 25px;background:#ff7f50;color:white;border:none;border-radius:8px;">Search</button>
  </div>

  <div class="recipe-container" id="recipeResults"></div>
</main>

<footer>Â© 2025 Maha Recipe Hub</footer>

<script>
// LOGIN UI
const loginLink=document.getElementById("login-link"),logoutLink=document.getElementById("logout-link"),welcomeMsg=document.getElementById("welcome-msg");
function checkLogin(){const u=localStorage.getItem("username");if(u){loginLink.style.display="none";welcomeMsg.style.display="inline";welcomeMsg.textContent="Welcome, "+u;logoutLink.style.display="inline";}}
logoutLink.onclick=()=>{localStorage.removeItem("username");location.reload();};checkLogin();

// SUPABASE
const client=supabase.createClient(
 "https://sraahdptzfbkrxrbllqx.supabase.co",
 "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNyYWFoZHB0emZia3J4cmJsbHF4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1NDczMjMsImV4cCI6MjA3NDEyMzMyM30.lJ6E8E70Mag1F7VC9jT7JLZqhcOX7oJBX20BhBWjZy0"
);

// SEARCH WITH SMART MATCH
document.getElementById("searchBtn").onclick = async () => {
  const input = document.getElementById("ingredientInput").value.toLowerCase().split(",").map(x=>x.trim());
  const resultsBox = document.getElementById("recipeResults");
  resultsBox.innerHTML = "Searching...";

  const { data: recipes } = await client.from("recipes").select("*");

  const scored = recipes.map(r => {
    const ing = r.ingredients.toLowerCase().split(",").map(x=>x.trim());
    const score = input.filter(i => ing.includes(i)).length;
    return { ...r, score };
  }).filter(r => r.score > 0)
    .sort((a,b)=>b.score-a.score);

  if (scored.length === 0) {
    resultsBox.innerHTML = "<p style='text-align:center;color:#666;'>No match found. Try different ingredients.</p>";
    return;
  }

  resultsBox.innerHTML = "";
  scored.forEach(r=>{
    const card = document.createElement("div");
    card.className = "recipe-card";
    card.innerHTML=`
      <img src="${r.image_url}">
      <h3>${r.name}</h3>
      <p>Match Score: ${r.score}</p>
    `;
    card.onclick = ()=>location.href=`recipe-detail.html?id=${r.id}`;
    resultsBox.appendChild(card);
  });
};
</script>

</body>
</html>
