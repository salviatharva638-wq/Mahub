<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Explore Recipes - Maha Recipe Hub</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
body { font-family:'Inter',sans-serif; margin:0; background:#fffaf5; color:#333; display:flex; flex-direction:column; min-height:100vh; }
header { display:flex; justify-content:space-between; align-items:center; padding:10px 30px; background:#fff; border-bottom:1px solid #eee; position:sticky; top:0; z-index:100; }
header img { height:50px; cursor:pointer; transition:0.3s; }
header img:hover { transform:scale(1.05); }
nav a { text-decoration:none; margin-left:15px; color:#333; font-weight:600; padding:6px 14px; border-radius:6px; transition:.3s; }
nav a:hover { background:#ff7f50; color:#fff; }
nav .login-btn { background:#ff7f50; color:white; }
nav #logout-link { background:#ff4c4c; color:white; }
nav #profile-link { background:#ff7f50; color:white; border-radius:50px; padding:6px 12px; display:flex; align-items:center; gap:5px; cursor:pointer; }
nav #profile-menu { display:none; position:absolute; top:70px; right:30px; background:white; border:1px solid #ddd; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1); width:180px; }
nav #profile-menu a { display:block; padding:10px 15px; text-decoration:none; color:#333; }
nav #profile-menu a:hover { background:#ff7f50; color:white; }

.page-strip { background:linear-gradient(90deg,#ff7f50,#ffb07f); color:white; text-align:center; font-size:2rem; font-weight:700; padding:20px 0; }

.search-container { display:flex; justify-content:center; margin:20px 0; gap:10px; flex-wrap:wrap; }
.search-container input { padding:10px 15px; width:250px; border-radius:8px; border:1px solid #ddd; }
.search-container select { padding:10px 12px; border-radius:8px; border:1px solid #ddd; }

.filter-tags { display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin-bottom:20px; }
.filter-tags button { padding:6px 12px; border:none; border-radius:8px; cursor:pointer; background:#ffb07f; color:white; transition:.3s; }
.filter-tags button.active, .filter-tags button:hover { background:#ff7f50; }

.recipe-container { display:flex; flex-wrap:wrap; justify-content:center; gap:25px; margin:auto; max-width:1200px; padding-bottom:50px; }
.recipe-card { background:white; border-radius:15px; overflow:hidden; width:250px; cursor:pointer; box-shadow:0 3px 8px rgba(0,0,0,0.1); transition:.3s; text-align:center; position:relative; }
.recipe-card:hover { transform:translateY(-8px) scale(1.02); }
.recipe-card img { width:100%; height:160px; object-fit:cover; }
.recipe-card h3 { color:#ff7f50; margin:12px 0 6px; }
.recipe-card p { padding:0 12px 12px; color:#555; }
.recipe-tags { margin-bottom:8px; }
.recipe-tag { background:#ffe5d6; color:#d35400; padding:2px 6px; border-radius:5px; font-size:0.8rem; margin:2px; display:inline-block; }
.badge { position:absolute; top:10px; left:10px; background:gold; color:white; padding:4px 8px; border-radius:6px; font-weight:bold; font-size:0.8rem; }

.like-btn { transition: transform 0.2s; }
.like-btn.animate { transform: scale(1.4); }

footer { background:#333; color:white; padding:25px; text-align:center; margin-top:auto; }

</style>
</head>
<body>

<header>
  <img src="logo.png" onclick="window.location.href='index.html'">
  <nav>
    <a href="index.html">Home</a>
    <a href="explore.html" style="background:#ff7f50;color:white;">Explore</a>
    <a href="recipe-generator.html">Find My Recipe</a>
    <a href="about.html">About</a>

    <!-- Login/Profile -->
    <a href="login.html" id="login-link" class="login-btn">Login</a>
    <div id="profile-link" style="display:none;"><i class="fas fa-user"></i> <span id="profile-username"></span></div>
    <div id="profile-menu">
      <a href="favorites.html">Favorites</a>
      <a href="#" id="logout-link">Logout</a>
    </div>
  </nav>
</header>

<div class="page-strip">Explore Recipes</div>

<div class="search-container">
  <input type="text" id="searchInput" placeholder="Search by recipe name or ingredient">
  <select id="sortSelect">
    <option value="time">Recently Added</option>
    <option value="popular">Most Popular</option>
    <option value="a-z">A-Z</option>
  </select>
</div>

<div class="filter-tags">
  <button data-type="all" class="active">All</button>
  <button data-type="vegetarian">Vegetarian</button>
  <button data-type="sweet">Sweet</button>
  <button data-type="spicy">Spicy</button>
  <button data-type="festive">Festive</button>
  <button data-type="gluten-free">Gluten-Free</button>
</div>

<main>
  <div id="status" style="text-align:center;margin-top:25px;">Loading recipes...</div>
  <div class="recipe-container" id="recipe-list"></div>
</main>

<footer>&copy; 2025 Maha Recipe Hub</footer>

<script>
// Supabase setup
const SUPABASE_URL = "https://sraahdptzfbkrxrbllqx.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNyYWFoZHB0emZia3J4cmJsbHF4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1NDczMjMsImV4cCI6MjA3NDEyMzMyM30.lJ6E8E70Mag1F7VC9jT7JLZqhcOX7oJBX20BhBWjZy0";
const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Login State
const loginLink = document.getElementById("login-link");
const profileLink = document.getElementById("profile-link");
const profileMenu = document.getElementById("profile-menu");
const profileUsername = document.getElementById("profile-username");
const logoutLink = document.getElementById("logout-link");

function checkLogin(){
  const user = localStorage.getItem("username");
  if(user){
    loginLink.style.display = "none";
    profileLink.style.display = "flex";
    profileUsername.textContent = user;
  } else {
    loginLink.style.display = "inline";
    profileLink.style.display = "none";
  }
}

profileLink.addEventListener("click", ()=>{
  profileMenu.style.display = profileMenu.style.display==="block"?"none":"block";
});

logoutLink.addEventListener("click", ()=>{
  localStorage.removeItem("username");
  checkLogin();
  profileMenu.style.display="none";
});

checkLogin();

// Load recipes
const recipeList = document.getElementById("recipe-list");
const searchInput = document.getElementById("searchInput");
const filterButtons = document.querySelectorAll(".filter-tags button");
const sortSelect = document.getElementById("sortSelect");
let recipes = [];
let currentFilter = "all";

async function loadRecipes(){
  const { data, error } = await client.from("recipes").select("*");
  const status = document.getElementById("status");
  if(error){
    status.textContent = "Failed to load recipes.";
    return;
  }
  status.style.display="none";
  recipes = data;
  renderRecipes(data);
}

function renderRecipes(list){
  recipeList.innerHTML="";
  if(list.length===0){
    recipeList.innerHTML="<p style='text-align:center;width:100%'>No recipes found!</p>";
    return;
  }

  const currentUser = localStorage.getItem("username");

  list.forEach(r=>{
    const tags = r.type ? r.type.split(",").map(t=>`<span class='recipe-tag'>${t.trim()}</span>`).join("") : "";
    const card = document.createElement("div");
    card.className="recipe-card";

    const festiveBadge = r.type && r.type.toLowerCase().includes("festive") ? `<span class='badge'>ðŸŒŸ Festive</span>` : "";
    const isLiked = r.liked_by && currentUser && r.liked_by.includes(currentUser);
    const heartColor = isLiked ? "red" : "gray";

    card.innerHTML = `
      ${festiveBadge}
      <img src="${r.image_url}">
      <h3>${r.name}</h3>
      <div class="recipe-tags">${tags}</div>
      <p>${r.description ? r.description.slice(0,80)+"..." : ""}</p>
      <div style="margin-bottom:10px;">
        <i class="fas fa-heart like-btn" style="color:${heartColor}; cursor:pointer; margin-right:5px;"></i>
        <span class="likes-count">${r.likes || 0}</span>
      </div>
    `;

    // Like button animation & functionality
    const heart = card.querySelector(".like-btn");
    heart.addEventListener("click", async (e)=>{
      e.stopPropagation();
      if(!currentUser){ alert("Login to like recipes!"); return; }
      heart.classList.add("animate");
      setTimeout(()=>heart.classList.remove("animate"), 300);

      let newLikes = r.likes || 0;
      let newLikedBy = r.liked_by || [];

      if(isLiked){
        newLikes -= 1;
        newLikedBy = newLikedBy.filter(u=>u!==currentUser);
      } else {
        newLikes += 1;
        newLikedBy.push(currentUser);
      }

      const { error } = await client.from("recipes").update({likes:newLikes, liked_by:newLikedBy}).eq("id", r.id);
      if(error){ alert("Failed to update likes."); return; }

      card.querySelector(".likes-count").textContent = newLikes;
      heart.style.color = isLiked?"gray":"red";
      r.likes = newLikes;
      r.liked_by = newLikedBy;
    });

    card.onclick = ()=> window.location.href=`recipe-detail.html?id=${r.id}`;
    recipeList.appendChild(card);
  });
}

// Filters & Search
searchInput.addEventListener("input", filterRecipes);
filterButtons.forEach(btn=>{
  btn.addEventListener("click", ()=>{
    filterButtons.forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    currentFilter = btn.dataset.type;
    filterRecipes();
  });
});
sortSelect.addEventListener("change", filterRecipes);

function filterRecipes(){
  const searchTerm = searchInput.value.toLowerCase();
  let filtered = recipes.filter(r=>{
    const matchesSearch = r.name.toLowerCase().includes(searchTerm) ||
                          (r.ingredients && r.ingredients.toLowerCase().includes(searchTerm));
    const matchesType = currentFilter==="all" || (r.type && r.type.toLowerCase().includes(currentFilter));
    return matchesSearch && matchesType;
  });

  const sortValue = sortSelect.value;
  if(sortValue==="a-z") filtered.sort((a,b)=>a.name.localeCompare(b.name));
  if(sortValue==="time") filtered.sort((a,b)=>new Date(b.created_at)-new Date(a.created_at));
  if(sortValue==="popular") filtered.sort((a,b)=>(b.likes||0)-(a.likes||0));

  renderRecipes(filtered);
}

loadRecipes();
</script>

</body>
</html>
