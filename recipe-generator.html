<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recipe Generator - Maha Recipe Hub</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
/* --- Same styling (unchanged) --- */
body { font-family: 'Inter', sans-serif; margin:0; background:#fff; color:#333; display:flex; flex-direction:column; min-height:100vh; }
header { display:flex; justify-content:space-between; align-items:center; padding:10px 30px; background:#fff; border-bottom:1px solid #eee; position:sticky; top:0; z-index:100; }
header img { height:50px; cursor:pointer; transition: transform 0.3s; }
header img:hover { transform: scale(1.05); }
nav { display:flex; align-items:center; gap:15px; }
nav a { text-decoration:none; color:#333; font-weight:600; padding:6px 14px; border-radius:6px; transition:all 0.3s; }
nav a:hover { background:#ff7f50; color:#fff; }
nav .login-btn { background:#ff7f50; color:#fff; }
nav #logout-link { background:#ff4c4c; color:#fff; }
.hero { background:linear-gradient(90deg,#ff7f50,#ffb07f); color:white; text-align:center; padding:60px 20px 40px 20px; }
main { flex:1; padding:40px 20px; text-align:center; }
.search-box { background:#fff; max-width:500px; margin:0 auto; padding:25px 20px; border-radius:15px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
.search-box input { width:90%; padding:12px; border-radius:8px; border:1px solid #ddd; margin-bottom:20px; }
.search-box button { padding:12px 30px; background:orange; color:white; border:none; border-radius:8px; cursor:pointer; }
.recipe-container { display:flex; flex-wrap:wrap; justify-content:center; gap:25px; margin-top:30px; opacity:0; transition:opacity 0.6s ease-in-out; }
.recipe-container.visible { opacity:1; }
.recipe-card { background:#fff; border-radius:15px; overflow:hidden; width:250px; cursor:pointer; box-shadow:0 3px 8px rgba(0,0,0,0.1); transition:0.3s; text-align:center; }
.recipe-card:hover { transform:translateY(-8px) scale(1.02); }
.recipe-card img { width:100%; height:160px; object-fit:cover; }
.recipe-info{padding:12px;} .badge{background:#ff7f50;color:#fff;padding:4px 8px;border-radius:12px;}
.no-results { color:#666; margin-top:20px; }
footer{background:#333;color:#fff;padding:20px;text-align:center;}
</style>
</head>
<body>

<header>
  <img src="logo.png" onclick="window.location.href='index.html'">
  <nav>
    <a href="index.html">Home</a>
    <a href="explore.html">Explore</a>
    <a href="recipe-generator.html" style="background:#ff7f50;color:#fff;">Find My Recipe</a>
    <a href="about.html">About</a>
    <a href="login.html" id="login-link" class="login-btn">Login</a>
    <span id="welcome-msg" style="display:none; font-weight:600;"></span>
    <a href="#" id="logout-link" style="display:none;">Logout</a>
  </nav>
</header>

<div class="hero">
  <h1>FIND YOUR RECIPE HERE</h1>
  <p>Enter ingredients you have and discover matching recipes instantly!</p>
</div>

<main>
  <div class="search-box">
    <input type="text" id="ingredientInput" placeholder="Enter ingredients (comma separated)">
    <button id="searchBtn">Search For Recipe</button>
  </div>

  <div class="recipe-container" id="recipeResults"></div>
</main>

<footer>
  &copy; 2025 Maha Recipe Hub | All Rights Reserved
</footer>

<script>
// SUPABASE SETUP
const SUPABASE_URL = "https://sraahdptzfbkrxrbllqx.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNyYWFoZHB0emZia3J4cmJsbHF4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1NDczMjMsImV4cCI6MjA3NDEyMzMyM30.lJ6E8E70Mag1F7VC9jT7JLZqhcOX7oJBX20BhBWjZy0";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// LOGIN STATE
const loginLink = document.getElementById("login-link");
const logoutLink = document.getElementById("logout-link");
const welcomeMsg = document.getElementById("welcome-msg");

if(localStorage.getItem("username")) {
  loginLink.style.display = "none";
  welcomeMsg.style.display = "inline";
  welcomeMsg.textContent = "Welcome, " + localStorage.getItem("username");
  logoutLink.style.display = "inline";
}
logoutLink.onclick = () => { localStorage.removeItem("username"); location.reload(); };

// SEARCH FEATURE
const searchBtn = document.getElementById("searchBtn");
const ingredientInput = document.getElementById("ingredientInput");
const resultBox = document.getElementById("recipeResults");

searchBtn.onclick = searchRecipes;

async function searchRecipes() {
  const entered = ingredientInput.value.trim().toLowerCase();
  if(!entered) return resultBox.innerHTML = `<p class='no-results'>Please enter ingredients.</p>`;

  const ingredients = entered.split(",").map(i=>i.trim());

  const { data: recipes } = await supabase.from("recipes").select("*");

  const matched = recipes.filter(r => {
    return ingredients.every(ing => r.ingredients.toLowerCase().includes(ing));
  });

  displayResults(matched);
}

function displayResults(list){
  resultBox.innerHTML = "";
  resultBox.classList.add("visible");

  if(list.length === 0){
    resultBox.innerHTML = `<p class='no-results'>No matching recipes found.</p>`;
    return;
  }

  list.forEach(r=>{
    const card = document.createElement("div");
    card.className="recipe-card";
    card.innerHTML = `
      <img src="${r.image_url}">
      <div class="recipe-info">
        <h3>${r.name}</h3>
        <p>${r.description?.slice(0,80) || ""}...</p>
        <span class="badge">${r.category || 'Uncategorized'}</span>
      </div>`;
    card.onclick = ()=>window.location.href=`recipe-detail.html?id=${r.id}`;
    resultBox.appendChild(card);
  });
}
</script>

</body>
</html>
