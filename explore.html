<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Explore Recipes - Maha Recipe Hub</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
body {
  font-family: 'Inter', sans-serif;
  margin: 0;
  background: #fffaf5;
  color: #333;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 30px;
  background: #fff;
  border-bottom: 1px solid #eee;
  position: sticky;
  top: 0;
  z-index: 100;
}
header img { height: 50px; cursor: pointer; transition: 0.3s; }
header img:hover { transform: scale(1.05); }

nav a {
  text-decoration: none;
  margin-left: 15px;
  color: #333;
  font-weight: 600;
  padding: 6px 14px;
  border-radius: 6px;
  transition: .3s;
}
nav a:hover { background: #ff7f50; color: #fff; }
nav .login-btn { background: #ff7f50; color: white; }
nav #logout-link { background: #ff4c4c; color: white; }

.page-strip {
  background: linear-gradient(90deg, #ff7f50, #ffb07f);
  color: white;
  text-align: center;
  font-size: 2rem;
  font-weight: 700;
  padding: 20px 0;
}

/* ðŸ”Ž Search Section */
.search-section {
  text-align: center;
  padding: 30px 20px;
  background: #fff3eb;
}
.search-bar {
  display: inline-flex;
  align-items: center;
  background: #fff;
  border-radius: 50px;
  padding: 8px 18px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  width: 60%;
  max-width: 520px;
  transition: 0.3s;
}
.search-bar:focus-within {
  box-shadow: 0 0 10px #ffb07f;
}
.search-bar input {
  border: none;
  outline: none;
  flex: 1;
  padding: 10px;
  font-size: 16px;
  border-radius: 50px;
}
.search-bar i {
  color: #ff7f50;
  font-size: 18px;
}

/* Filter + Sort */
.filter-bar {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  gap: 12px;
  margin-top: 15px;
}

.filter-tags {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  animation: fadeIn 0.5s ease-in;
}

.filter-tags button {
  background: #fff;
  border: 2px solid #ff7f50;
  color: #ff7f50;
  padding: 6px 16px;
  border-radius: 20px;
  cursor: pointer;
  transition: 0.3s;
}
.filter-tags button.active,
.filter-tags button:hover {
  background: #ff7f50;
  color: white;
}

.sort-select {
  border: 2px solid #ff7f50;
  background: white;
  color: #ff7f50;
  border-radius: 20px;
  padding: 6px 14px;
  font-weight: 600;
  cursor: pointer;
  transition: 0.3s;
}
.sort-select:hover {
  background: #ff7f50;
  color: white;
}

/* Recipe Cards */
.recipe-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 25px;
  margin: auto;
  max-width: 1200px;
  padding: 40px 20px 60px;
  transition: all 0.5s;
}
.recipe-card {
  background: white;
  border-radius: 16px;
  overflow: hidden;
  width: 260px;
  cursor: pointer;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  transition: all .3s;
  text-align: center;
  animation: fadeIn 0.5s ease-in;
  position: relative;
}
.recipe-card:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 6px 14px rgba(0,0,0,0.15);
}
.recipe-card img {
  width: 100%;
  height: 160px;
  object-fit: cover;
}
.recipe-card h3 {
  color: #ff7f50;
  margin: 12px 0 6px;
}
.recipe-card p {
  padding: 0 12px 12px;
  color: #555;
  font-size: 0.95rem;
}

/* Recipe Tags */
.recipe-tags {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 6px;
  padding: 0 10px 10px;
}
.recipe-tag {
  background: #ff7f50;
  color: white;
  padding: 3px 10px;
  border-radius: 15px;
  font-size: 0.75rem;
  transition: 0.3s;
}
.recipe-card:hover .recipe-tag {
  background: #ff986e;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

footer {
  background: #333;
  color: white;
  padding: 25px;
  text-align: center;
  margin-top: auto;
}
</style>
</head>
<body>

<header>
  <img src="logo.png" onclick="window.location.href='index.html'">
  <nav>
    <a href="index.html">Home</a>
    <a href="explore.html" style="background:#ff7f50;color:white;">Explore</a>
    <a href="recipe-generator.html">Find My Recipe</a>
    <a href="about.html">About</a>
    <a href="login.html" id="login-link" class="login-btn">Login</a>
    <span id="welcome-msg" style="display:none;"></span>
    <a href="#" id="logout-link" style="display:none;">Logout</a>
  </nav>
</header>

<div class="page-strip">Explore Recipes</div>

<section class="search-section">
  <div class="search-bar">
    <i class="fa fa-search"></i>
    <input type="text" id="searchInput" placeholder="Search by recipe name or ingredient...">
  </div>

  <div class="filter-bar">
    <div class="filter-tags">
      <button data-type="all" class="active">All</button>
      <button data-type="vegetarian">Vegetarian</button>
      <button data-type="vegan">Vegan</button>
      <button data-type="gluten-free">Gluten-Free</button>
      <button data-type="sweet">Sweet</button>
      <button data-type="spicy">Spicy</button>
    </div>
    <select id="sortSelect" class="sort-select">
      <option value="newest">Newest First</option>
      <option value="a-z">Aâ€“Z</option>
      <option value="popular">Most Popular</option>
    </select>
  </div>
</section>

<main>
  <div id="status" style="text-align:center;margin-top:25px;">Loading recipes...</div>
  <div class="recipe-container" id="recipe-list"></div>
</main>

<footer>&copy; 2025 Maha Recipe Hub</footer>

<script>
const SUPABASE_URL = "https://sraahdptzfbkrxrbllqx.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNyYWFoZHB0emZia3J4cmJsbHF4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1NDczMjMsImV4cCI6MjA3NDEyMzMyM30.lJ6E8E70Mag1F7VC9jT7JLZqhcOX7oJBX20BhBWjZy0";
const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const recipeList = document.getElementById("recipe-list");
const searchInput = document.getElementById("searchInput");
const filterButtons = document.querySelectorAll(".filter-tags button");
const sortSelect = document.getElementById("sortSelect");

let recipes = [];
let currentFilter = "all";

async function loadRecipes() {
  const { data, error } = await client.from("recipes").select("*");
  const status = document.getElementById("status");
  console.log(data, error);

  if (error) {
    status.textContent = "Failed to load recipes.";
    return;
  }

  status.style.display = "none";
  recipes = data;
  renderRecipes(data);
}

function renderRecipes(list) {
  recipeList.innerHTML = "";
  if (list.length === 0) {
    recipeList.innerHTML = "<p style='text-align:center;width:100%'>No recipes found!</p>";
    return;
  }

  list.forEach(r => {
    const tags = r.type ? r.type.split(",").map(t => `<span class='recipe-tag'>${t.trim()}</span>`).join("") : "";
    const card = document.createElement("div");
    card.className = "recipe-card";
    card.innerHTML = `
      <img src="${r.image_url}" alt="${r.name}">
      <h3>${r.name}</h3>
      <div class="recipe-tags">${tags}</div>
      <p>${r.description ? r.description.slice(0, 80) + "..." : ""}</p>
    `;
    card.onclick = () => window.location.href = `recipe-detail.html?id=${r.id}`;
    recipeList.appendChild(card);
  });
}

searchInput.addEventListener("input", filterRecipes);
filterButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    filterButtons.forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    currentFilter = btn.dataset.type;
    filterRecipes();
  });
});
sortSelect.addEventListener("change", filterRecipes);

function filterRecipes() {
  const searchTerm = searchInput.value.toLowerCase();
  let filtered = recipes.filter(r => {
    const matchesSearch =
      r.name.toLowerCase().includes(searchTerm) ||
      (r.ingredients && r.ingredients.toLowerCase().includes(searchTerm));
    const matchesType =
      currentFilter === "all" ||
      (r.type && r.type.toLowerCase().includes(currentFilter));
    return matchesSearch && matchesType;
  });

  const sortValue = sortSelect.value;
  if (sortValue === "a-z") filtered.sort((a, b) => a.name.localeCompare(b.name));
  if (sortValue === "newest") filtered.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
  if (sortValue === "popular") filtered.sort((a, b) => (b.likes || 0) - (a.likes || 0));

  renderRecipes(filtered);
}

// âœ… Login State
const loginLink = document.getElementById("login-link");
const logoutLink = document.getElementById("logout-link");
const welcomeMsg = document.getElementById("welcome-msg");

function checkLogin() {
  const user = localStorage.getItem("username");
  if (user) {
    loginLink.style.display = "none";
    welcomeMsg.style.display = "inline";
    welcomeMsg.textContent = "Welcome, " + user;
    logoutLink.style.display = "inline";
  }
}

logoutLink.onclick = () => {
  localStorage.removeItem("username");
  location.reload();
};

checkLogin();
loadRecipes();
</script>
</body>
</html>





